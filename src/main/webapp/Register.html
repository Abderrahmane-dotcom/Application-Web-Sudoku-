<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Sign Up</title>
  <link rel="stylesheet" type="text/css" href="Registerstyle.css">
</head>
<body>
  <div class="container">
    <div class="login-box">
      <h2>Sign Up</h2>
      <form action="register" method="post" id="RegisterForm">
        <div class="form-group">
          <label for="username">Nom d'utilisateur :</label>
          <input type="text" id="username" name="username" required>
        </div>
        <div class="form-group">
          <label for="email">Adresse e-mail :</label>
          <input type="email" id="email" name="email" required>
        </div>
        <div class="form-group">
          <label for="password">Mot de passe :</label>
          <input type="password" id="password" name="password" required>
          <label for="confirmation_password">Confirmer mot de passe :</label>
          <input type="password" id="confirmation_password" name="confirmation_password" required>
        </div>
        <input type="submit" value="S'inscrire" class="submit-button">
      </form>
    </div>
  </div>
<script>
  // R√©cup√©rer le formulaire de connexion
  var variable_de_test ;
  variable_de_test = 0;
  var registerForm = document.getElementById('RegisterForm');

  // Ajouter un √©couteur d'√©v√©nement pour la soumission du formulaire
  registerForm.addEventListener('submit', function(event) {
    // Pr√©venir la soumission du formulaire jusqu'√† la validation
    event.preventDefault();

    // Vider le localStorage
    localStorage.clear();

    // R√©cup√©rer la valeur de l'e-mail
    var userEmail = document.getElementById('email').value;
    var userName = document.getElementById('username').value;
  	var data_tow = [userEmail,userName];

    // V√©rifier si le mot de passe correspond √† la confirmation du mot de passe
    var password = document.getElementById('password').value;
    var confirmationPassword = document.getElementById('confirmation_password').value;

    if (password !== confirmationPassword) {
      alert("Le mot de passe et la confirmation du mot de passe ne correspondent pas.");
      return; // Emp√™cher la soumission du formulaire
    }

    // Cr√©ation de la WebSocket
    var socket = new WebSocket('ws://localhost:8083/zPFA_Sudoku/check-email-username');

    // Ajouter un √©couteur d'√©v√©nement pour l'ouverture de la connexion WebSocket
    socket.addEventListener('open', function() {
      // Envoyer l'email via WebSocket
	  	socket.send(JSON.stringify(data_tow));    
    });

    

    socket.addEventListener('message', function (event) {
    	
    	var listeJSON = event.data; // R√©cup√©rer la cha√Æne JSON du message

    	  var liste = JSON.parse(listeJSON); // Convertir la cha√Æne JSON en liste JavaScript

    	  // Traiter la liste
    	  liste.forEach(function(objet) {
    	    console.log(objet.id, objet.nom);
    	  });
    	  if(liste[0]==="not_exists" & liste[1]==="not_exists"){
    		  	localStorage.setItem('email', userEmail);
			    console.log("Script JavaScript ex√©cut√© !");

			    socket.close();
			    socket= null;    	
	      		
			    registerForm.submit();
    	  }
    	  else if (liste[0]==="exists"){
    	        alert('Cet email existe dans notre base de donn√©es. Veuillez utiliser un autre email üòä.');
			    socket.close();
			    socket= null; 
    	  }
    	  else if (liste[1]==="exists"){
		        alert('Ce nom d\'utilisateur existe d√©j√†. Veuillez utiliser un autre nom üòä.');
			    socket.close();
			    socket= null; 
  	  }
 	
    })
    
    
    
    
    socket.addEventListener('error', function(error) {
      console.error('WebSocket error: ', error);
    });
  		   
  });
</script>

</body>
</html>